@page "/TaxCalculator"
@{
    ViewData["Title"] = "Index";
}

<div id="main" class="">
    <div class="banner-home about-page">
        <div class="banner tax-banner about-banner">
            <div class="container">
                <div class="banner-detail ">
                    <h1 class="heading">
                        Tax Calculator
                    </h1>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="reg-code-holder mt20">
            <form class="form-inline">

                <div class="form-group col-sm-9 col-9 error-message-holder">
                    <label for="registrationcode" class="sr-only">Enter Property Value</label>
                    <input type="text"  data-bind="NumberOnly,value:propertyValue" class="form-control" id="registrationcode" placeholder="Enter Property Value">
                </div>
                <button type="submit" data-bind="click: onCalculate" class="btn btn-primary ">
                    Calculate
                </button>
            </form>
        </div>
        <div class="tax-calculation-holder">
            <div class="tax-calculation">

                <div class="Calculation-table">
                    <div class="table-responsive">
                        <table class="table">
                            <tr>
                                <th colspan="3"> Applicable Tax Calculation (Rs)</th>
                            </tr>
                            <tr>
                                <td>Stamp Duty</td>
                                <td data-bind="text:StampDutyPercentage" align="right"></td>
                                <td width="250px" data-bind="text:StampDuty" align="right"></tdwidth="140px">
                            </tr>
                            <tr>
                                <td>District Council Fee</td>
                                <td data-bind="text:DistrictCouncilFeePercentage" align="right"></td>
                                <td width="250px" data-bind="text:DistrictCouncilFee" align="right"></td>
                            </tr>
                            <tr>
                                <td> Capital Value Tax</td>
                                <td data-bind="text:CapitalValueTaxPercentage" align="right"></td>
                                <td width="250px" data-bind="text:CapitalValueTax" align="right"></td>
                            </tr>
                            <tr>
                                <td>Registration Fee</td>
                                <td align="right">Fixed</td>
                                <td width="250px" data-bind="text:RegistrationFee" align="right"></td>
                            </tr>
                            <tr>
                                <td width="140px">Total </td>
                                <td data-bind="text:Total" colspan="2" align="right"></td>

                            </tr>
                            <tr>
                                <td width="140px">Total in Words</td>
                                <td data-bind="text:TotalWords" colspan="2" align="right">Three Lakhs Five Hundred</td>
                            </tr>

                        </table>
                        <div class="align-right-center">
                            <input  data-bind="click: onClick" type="submit" class=" btn btn-primary mt10 calculator-dc" name="Calculate Land Value at DC Rate" value="Calculate Land Value at DC Rate">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script>

        function convertNumberToWords(amount) {
            var words = new Array();
            words[0] = '';
            words[1] = 'One';
            words[2] = 'Two';
            words[3] = 'Three';
            words[4] = 'Four';
            words[5] = 'Five';
            words[6] = 'Six';
            words[7] = 'Seven';
            words[8] = 'Eight';
            words[9] = 'Nine';
            words[10] = 'Ten';
            words[11] = 'Eleven';
            words[12] = 'Twelve';
            words[13] = 'Thirteen';
            words[14] = 'Fourteen';
            words[15] = 'Fifteen';
            words[16] = 'Sixteen';
            words[17] = 'Seventeen';
            words[18] = 'Eighteen';
            words[19] = 'Nineteen';
            words[20] = 'Twenty';
            words[30] = 'Thirty';
            words[40] = 'Forty';
            words[50] = 'Fifty';
            words[60] = 'Sixty';
            words[70] = 'Seventy';
            words[80] = 'Eighty';
            words[90] = 'Ninety';
            amount = amount.toString();
            var atemp = amount.split(".");
            var number = atemp[0].split(",").join("");
            var n_length = number.length;
            var words_string = "";
            var append_string = "";
            if (n_length > 9) {

                var appendamount = amount.substring(0, n_length - 9);
                var appendNumber = appendamount.split(",").join("");
                var append_length = appendNumber.length;
                if (append_length <= 9) {
                    var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
                    var received_n_array = new Array();
                    for (var i = 0; i < append_length; i++) {
                        received_n_array[i] = appendNumber.substr(i, 1);
                    }
                    for (var i = 9 - append_length, j = 0; i < 9; i++ , j++) {
                        n_array[i] = received_n_array[j];
                    }
                    for (var i = 0, j = 1; i < 9; i++ , j++) {
                        if (i == 0 || i == 2 || i == 4 || i == 7) {
                            if (n_array[i] == 1) {
                                n_array[j] = 10 + parseInt(n_array[j]);
                                n_array[i] = 0;
                            }
                        }
                    }
                    value = "";
                    for (var i = 0; i < 9; i++) {
                        if (i == 0 || i == 2 || i == 4 || i == 7) {
                            value = n_array[i] * 10;
                        } else {
                            value = n_array[i];
                        }
                        if (value != 0) {
                            append_string += words[value] + " ";
                        }
                        if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                            append_string += "Crores ";
                        }
                        if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                            append_string += "Lakhs ";
                        }
                        if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                            append_string += "Thousand ";
                        }
                        if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                            append_string += "Hundred ";
                        } else if (i == 6 && value != 0) {
                            append_string += "Hundred ";
                        }
                    }

                    append_string = append_string + "Arab ";
                   
                    number = number.substr(append_length, n_length);
                    n_length = number.length;
                }
            }

            if (n_length <= 9) {
                var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
                var received_n_array = new Array();
                for (var i = 0; i < n_length; i++) {
                    received_n_array[i] = number.substr(i, 1);
                }
                for (var i = 9 - n_length, j = 0; i < 9; i++ , j++) {
                    n_array[i] = received_n_array[j];
                }
                for (var i = 0, j = 1; i < 9; i++ , j++) {
                    if (i == 0 || i == 2 || i == 4 || i == 7) {
                        if (n_array[i] == 1) {
                            n_array[j] = 10 + parseInt(n_array[j]);
                            n_array[i] = 0;
                        }
                    }
                }
                value = "";
                for (var i = 0; i < 9; i++) {
                    if (i == 0 || i == 2 || i == 4 || i == 7) {
                        value = n_array[i] * 10;
                    } else {
                        value = n_array[i];
                    }
                    if (value != 0) {
                        words_string += words[value] + " ";
                    }
                    if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                        words_string += "Crores ";
                    }
                    if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                        words_string += "Lakhs ";
                    }
                    if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                        words_string += "Thousand ";
                    }
                    if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                        words_string += "Hundred ";
                    } else if (i == 6 && value != 0) {
                        words_string += "Hundred ";
                    }
                }
                words_string = words_string.split("  ").join(" ");
            }
            return append_string + words_string;
        }

        $(document).ready(function () {
            $lib.setPageTitle("Tax Calculator");
            var viewModel = {};
            viewModel.propertyValue = ko.observable().extend({
                required: true, maxLength: 11
                //pattern: { message: $constants.alphaNumericMessage, params: $constants.alphaNumericRegex }
            });
            viewModel.StampDuty = ko.observable();
            viewModel.DistrictCouncilFee = ko.observable();
            viewModel.RegistrationFee = ko.observable();
            viewModel.CapitalValueTax = ko.observable();
            viewModel.Total = ko.observable();
            viewModel.TotalWords = ko.observable();
            viewModel.CalculateDCLink = ko.observable();

            viewModel.StampDutyPercentage = ko.observable();
            viewModel.DistrictCouncilFeePercentage = ko.observable();
            viewModel.CapitalValueTaxPercentage = ko.observable();

            viewModel.StampDutyPercentage($lib.appSettings.StampDutyPercentage + "%");
            viewModel.DistrictCouncilFeePercentage($lib.appSettings.DistrictCouncilFeePercentage + "%");
            viewModel.CapitalValueTaxPercentage($lib.appSettings.CapitalValueTaxPercentage + "%");
            viewModel.RegistrationFee($lib.appSettings.RegistrationFee);
            viewModel.CalculateDCLink($lib.appSettings.CalculateDCRateLink),

            viewModel.onCalculate = function () {

                if (viewModel.errors().length == 0) {
                    var StampDuty = ((viewModel.propertyValue() * $lib.appSettings.StampDutyPercentage) / 100);
                    var DistrictCouncilFee = ((viewModel.propertyValue() * $lib.appSettings.DistrictCouncilFeePercentage) / 100);
                    var CapitalValueTax = ((viewModel.propertyValue() * $lib.appSettings.CapitalValueTaxPercentage) / 100);

                    viewModel.StampDuty($util.formatAmount(StampDuty,2));
                    viewModel.DistrictCouncilFee($util.formatAmount(DistrictCouncilFee,2));
                    viewModel.CapitalValueTax($util.formatAmount(CapitalValueTax,2));

                    var total = StampDuty + DistrictCouncilFee + CapitalValueTax + + $lib.appSettings.RegistrationFee;
                    viewModel.Total($util.formatAmount(total,2));
                    viewModel.TotalWords(convertNumberToWords(total));
                }
                else {
                    viewModel.errors.showAllMessages();
                }

            }

            viewModel.onClick = function () {
                
                var newWindow = window.open($lib.appSettings.CalculateDCRateLink, '_blank');
            }

            viewModel.errors = ko.validation.group(viewModel);
            $lib.bindUI(viewModel);
           // theEditor.isReadOnly = true;
        });

       

      //  $lib.appSettings.StampDutyPercentage;
        //console.log($lib.appSettings);

       
    </script>
}
